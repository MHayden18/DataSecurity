#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sat May 18 13:30:24 2019

@author: addisonbe
"""
import myCrypto
import binascii

def rsa_crt():
	p=746918102493791635978193561925721521389032052060112172075459444248371637125882659108701788279703937129433460421980370946593275011119478827487952130508595494667132962509346066444173629933542034611349127294985122855148692317272081832653386053404119607909727427288852579770661102816237865042771110546997476684561748670283323640304519933612840892420981084997366260180671455206477913829795670157257365173452973064792486521200856564666008816816780350815820044763001316822233187749886589171123882157333088392566735010162590693536046065401333607946984763846634871796116399582170704067630484997638162565246552787306510914923141709331583145612310041716371196851338589643901538376538279087339870225729575253499899658317947498802811336568467784771900582854306507238819017517071766552772338666361848365082108932880437540006597322334002935748823989324243052295875316065754163017143226561469576772653377243063015901623036924836665926519722666928187517570967297837810319990738668920133999513945141652641095017117612721840258064820950116716356536809434137798390068749884237811960937433741759648321370156524131652688632823440710382828633948444254801474596748914967267909500422048953092038538565308950024851294087157787453573200390805681011203647968599399385192933542951282719065296626312768340087443029134790263168785428488441635982090400201167597353171633932287151706201672922928743112064797089281631964128111744779807137674580595674825374982301211821499882004437030146698162882340018515739232003448471709845657382717801196163821717655032564766445446713689386343924477281607447183355164924361321267577961236960495780283996288663363020330190133853769183112036008423793049767664387326259144899916753096948913557079157958446335128778905156320655386821711258216889581417607854591268007197486427231345134027034350868785577277958907643070119930745593961990922337345618339515642280926397182396039919205396863909405472244586764342679258504044956556471426401873925794576489138391386794032157335905588360218403477760696058416186116510392817140120014335769652681861445535845711438716437451581761753921354121013106851767238083159577485707898000578003295590012745608922419841645845037589160173710764905802296704751734179571894835043919619210788009899705989648303980892100685316885995614435869224023892324573935337810711215798973021223258970258511774319625666093990120040942958131477633348048523293277072155238823439960403922071941904769362002288332652920453704773221932734776758309867263060874477
	q=1019368383220082033812320071753804562181490082201026772967927544232545804882102607865081646959397277694133040626021732826820056755305861601619139173427958985092076798221998607232162324519645910309264862307736963617176645050943363566012752561337882595757665141571827444256486006064243257597204838142146514511174316112181739694814358617032431802946772247234174298610451734482190114753662993056257231092542946659096921859024201765148408664739562885254777074004167534541264782035856566652376369843011271408271557540446172117859358849052379484271977657086161005059083762050824057484971668003111338068536737675996368958781862836699320028202394340027486274828200826039794599481833937174932099062909119299453251679327170068958734717990542297950066150809998564791253900762761552486831535221759616213840070493093449506902288327854551452188177655227688184965655498350757671547274914321889362023627306206891788221970191352394208949092683555700701820062522184259859508718854871421539848163869514706981455519229108877611829150174993813363669111666422692172514703588272328287062441908614543136781647666174080816467925963110402031524659002272136526845298650545178496572779569333497959320910821262668903868109944053208640634373753763212834273955717088383992684025924233067970047339777209200023527441632836380558527080285263308571186181560934662363651359997193053348433710234579033648882762632444040384504537799730450868367293898200973318350663025723229799338284394093691807544481263284832415828263318452987283646014704643124365131004511916431953965906522629425337916111219142300934349947755884717590931843764344281022888767961665407442064175609272850211861778462446388201595455800360163352268966581951140996701511583707107619818705042974753850964937472955151175568648380607737306629656906389540817637840864649829210367885717439522971868654361841471338530505315615191194649922765920473476018809861457355693455108828707292614672921475043922368236277238759773569338551373563648476327609134756156508100221298270414349494520976678788122110748181735593680829863422551266656048754206001345953081314209037946469068853030850037941865164509633345653061783789218182111826488086710136874421138811972674650529776179293885352514553129887007521085964895209759860810322321246636980264342320945546012475537878990333690483174302803317624880405900474279743021202897457615080232582392378077813744626494617853128444314169063119687560470773673998161414803814743349462786003448195478607193782012031548381701
	n=p*q
	e=65537
	
	# 
	# file = open("message.txt",'r')
	# message = file.read()
	# m = int(binascii.hexlify(message.encode()),16);
	#
	m=6376750597334872524063275314930822077393410097200752395065294313732357165582011717368244347113421095401321193199226940706382979347785818716529882529797228779035350669985486366433128204713004147644752270915065381184730437255211288608811541036675112991118814584959677070819567733835929004481287842389154411484627611619902110085571125334162582282451955207044749279764232433401110255578310767120016704989260189286654413393040122933242856710683937662543105133040185514823848053664122488619588042681959434111110777866939982568166692845129817024007544912025384155152377201235336306459431065204534105672288618253066163501508950488386649571046892406726172027459649303333582452518896663650402066273448510115729390725630882998479766388382916996298533142917236611226812283251898135901176044969829252307624360051190213995140881677444221956679933982954435484301485543537244552708393395455977325566705990373212856779156475938479598833990738570011950
	cipherText=pow(m,e,n)
	
	# TODO
	phi = (p-1)*(q-1)
	d = myCrypto.mulinv(e, phi)
	
	# Transform ciphertext and private key into CRT:
	y_p = cipherText % p
	y_q = cipherText % q
	d_p = d % (p-1)
	d_q = d % (q-1)
	
	# Find transformed plaintext:
	decrypt_p = pow(y_p, d_p, p)
	decrypt_q = pow(y_q, d_q, q)
	
	# Modular Inverse of small exponents:
	c_p = myCrypto.mulinv(q, p)		# c_p = q^(-1) mod p
	c_q = myCrypto.mulinv(p, q)		
	
	# Decrypt using CRT:
	decryptedText = ( q * c_p * decrypt_p + p * c_q * decrypt_q ) % n
	
	# Final output:
	plainText = binascii.unhexlify(hex(decryptedText)[2:]).decode()  # [2:] slicing, to strip the 0x part 
	print(plainText)

